# Watchmen

Avatar² allows the user to hook various events during the 
orchestration. These hooks are user defined callbacks and allow to change or
inspect the analyses state before or after the according event occured.

The interface for adding such a hook looks as follows:
```python
from avatar2 import *

def my_callback(avatar, *args, **kwargs):
    print("StateTransfer occured!")

avatar = Avatar()
avatar.watchmen.add_watchmen('StateTransfer', 'after', my_callback)
```

The first argument is the event to be hooked, the second argument 
specifies whether the callback shall be executed before or after the event is 
handled, and the third argument is a reference to the callback function to be
 executed.

For now, avatar² supports to hook the following events:

| event-name        | trigger                                          | additional vars                                    |
|-------------------|--------------------------------------------------|----------------------------------------------------|
| StateTransfer     | Transfering the state from one target to another | from_target, to_target, sync_regs, synced_ranges |
| BreakpointHit     | A breakpoint is reached                          | BreakpointMessage                                  |
| UpdateState       | A target changes its state                       | UpdateStateMessage                                 |
| RemoteMemoryRead  | A forwarded memory read is happening             | RemoteMemoryReadMessage                            |
| RemoteMemoryWrite | A forwarded memory write is happening            | RemoteMemoryWriteMessage                           |
| AvatarGetStatus   | The current status of avatar is requested        | -                                                  |

While all of the callbacks will get the avatar-instance passed as the first
argument, additional arguments may be passed as well, as shown in the table.
Quite notable, a lot of events will allow to inspect _AvatarMessages_. These
are envelops containing all important information about a specific event.
These messages are normally generated by the targets' protocols and are passed to
the avatar instance which dispatches them.
